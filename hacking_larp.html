<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERMINAL - SECURE ACCESS</title>
    <style>
        :root {
            --bg-color: #0a0a0a;
            --text-color: #00ff41;
            --font-family: 'Courier New', Courier, monospace;
            --glow-color: rgba(0, 255, 65, 0.5);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-family);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        #terminal {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            position: relative;
            z-index: 1;
        }

        /* CRT Effects */
        #crt-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                rgba(18, 16, 16, 0) 50%,
                rgba(0, 0, 0, 0.1) 50%
            ), linear-gradient(
                90deg,
                rgba(255, 0, 0, 0.03),
                rgba(0, 255, 0, 0.01),
                rgba(0, 0, 255, 0.03)
            );
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 10;
        }

        #crt-overlay::after {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: rgba(18, 16, 16, 0.1);
            opacity: 0;
            z-index: 10;
            pointer-events: none;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0% { opacity: 0.27861; }
            5% { opacity: 0.34769; }
            10% { opacity: 0.23604; }
            15% { opacity: 0.90626; }
            20% { opacity: 0.18128; }
            25% { opacity: 0.83891; }
            30% { opacity: 0.65583; }
            35% { opacity: 0.57807; }
            40% { opacity: 0.26559; }
            45% { opacity: 0.84693; }
            50% { opacity: 0.96019; }
            55% { opacity: 0.08523; }
            60% { opacity: 0.71056; }
            65% { opacity: 0.73437; }
            70% { opacity: 0.28557; }
            75% { opacity: 0.96303; }
            80% { opacity: 0.2268; }
            85% { opacity: 0.20428; }
            90% { opacity: 0.1917; }
            95% { opacity: 0.12144; }
            100% { opacity: 0.83713; }
        }

        #scanline {
            width: 100%;
            height: 100px;
            z-index: 11;
            background: linear-gradient(
                0deg,
                rgba(0, 0, 0, 0) 0%,
                rgba(0, 255, 65, 0.1) 50%,
                rgba(0, 0, 0, 0) 100%
            );
            opacity: 0.1;
            position: absolute;
            bottom: 100%;
            animation: scanline 10s linear infinite;
        }

        @keyframes scanline {
            0% { bottom: 100%; }
            80% { bottom: 100%; }
            100% { bottom: -100px; }
        }

        #output {
            margin-bottom: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .line {
            margin: 2px 0;
            text-shadow: 0 0 5px var(--glow-color);
        }

        .input-area {
            display: flex;
            align-items: center;
        }

        #prompt {
            margin-right: 10px;
            user-select: none;
        }

        #input {
            background: transparent;
            border: none;
            color: var(--text-color);
            font-family: var(--font-family);
            font-size: 16px;
            outline: none;
            flex: 1;
            text-shadow: 0 0 5px var(--glow-color);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #000;
        }
        ::-webkit-scrollbar-thumb {
            background: #004411;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #00ff41;
        }

        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.1;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="crt-overlay"></div>
    <div id="scanline"></div>
    <canvas id="matrix-canvas" class="matrix-bg"></canvas>

    <div id="terminal">
        <div id="output"></div>
        <div class="input-area">
            <span id="prompt">guest@null:~$</span>
            <input type="text" id="input" autofocus spellcheck="false" autocomplete="off">
        </div>
    </div>

    <script>
        const output = document.getElementById('output');
        const input = document.getElementById('input');
        const terminal = document.getElementById('terminal');
        const promptSpan = document.getElementById('prompt');

        const state = {
            user: 'guest',
            hostname: 'null',
            cwd: '/',
            isMatrixActive: false,
            isHollywoodMode: false,
            files: {
                '/': ['README.txt', 'bin', 'etc', 'usr', 'home'],
                '/home': ['guest'],
                '/home/guest': ['mission_params.enc', 'notes.txt'],
                '/etc': ['passwd', 'hosts', 'motd'],
                '/bin': ['ls', 'cat', 'help', 'ssh', 'scan', 'crack', 'exploit', 'clear']
            },
            fileContent: {
                'README.txt': 'Welcome to the Underground Terminal.\nThis system is for authorized personnel only.\nIf you are a guest, proceed with caution.',
                'notes.txt': 'Remember: The target server is at 192.168.1.104.\nThey have a vulnerability in their SSH service.',
                'mission_params.enc': '01001101 01001001 01010011 01010011 01001001 01001111 01001110 00111010 00100000 01001000 01000001 01000011 01001011 00100000 01010100 01001000 01000101 00100000 01010000 01001100 01000001 01001110 01000101 01010100',
                'motd': 'Access is a privilege, not a right.',
                'passwd': 'root:x:0:0:root:/root:/bin/bash\nguest:x:1000:1000:guest:/home/guest:/bin/bash'
            },
            history: [],
            historyIdx: 0
        };

        const hollywoodSnippets = [
            "void* p = malloc(sizeof(buffer) * 0x400);",
            "if (connect(sockfd, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0) exit(1);",
            "for (int i = 0; i < N; i++) { hash = ((hash << 5) + hash) + str[i]; }",
            "packet = (char *)malloc(HEADER_SIZE + payload_len);",
            "memcpy(packet + HEADER_SIZE, payload, payload_len);",
            "socket(AF_INET, SOCK_RAW, IPPROTO_TCP);",
            "while(1) { fork(); } // KERNEL PANIC PREVENTION",
            "0xDEADC0DE: mov eax, [ebx + 0x14]",
            "xor ecx, ecx; int 0x80;",
            "Injection successful. Bypassing NX bit...",
            "ROP chain established at 0x7fffffffe000",
            "Overflowing stack buffer... [OK]",
            "Searching for libc base address...",
            "Target: 127.0.0.1 -> Exploit: CVE-2023-XXXX",
            "ACCESS GRANTED: ROOT SHELL ACQUIRED"
        ];

        // Sound Engine
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;

        function playSound(freq, type, duration, volume = 0.1) {
            if (!audioCtx) audioCtx = new AudioCtx();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(volume, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.00001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function clickSound() {
            playSound(150 + Math.random() * 50, 'sine', 0.05, 0.05);
        }

        function accessGrantedSound() {
            playSound(400, 'square', 0.1, 0.1);
            setTimeout(() => playSound(600, 'square', 0.3, 0.1), 100);
        }

        function accessDeniedSound() {
            playSound(150, 'sawtooth', 0.3, 0.1);
        }

        function printLine(text, className = 'line', delay = 0) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const div = document.createElement('div');
                    div.className = className;
                    div.textContent = text;
                    output.appendChild(div);
                    terminal.scrollTop = terminal.scrollHeight;
                    clickSound();
                    resolve(div);
                }, delay);
            });
        }

        async function printLines(lines, delayBetween = 100) {
            for (const line of lines) {
                await printLine(line, 'line', delayBetween);
            }
        }

        function updatePrompt() {
            promptSpan.textContent = `${state.user}@${state.hostname}:${state.cwd}$`;
        }

        const commands = {
            help: () => {
                printLines([
                    "Available commands:",
                    "  help      - Show this help message",
                    "  ls        - List directory contents",
                    "  cat       - Display file content",
                    "  whoami    - Display current user",
                    "  clear     - Clear the terminal screen",
                    "  date      - Display current date and time",
                    "  ssh       - Connect to a remote host (usage: ssh <ip>)",
                    "  scan      - Scan for network targets (usage: scan <ip_range>)",
                    "  crack     - Attempt to crack a password (usage: crack <target>)",
                    "  exploit   - Launch an exploit (usage: exploit <target>)",
                    "  decrypt   - Decrypt a file (usage: decrypt <file>)",
                    "  matrix    - Toggle visual matrix effect",
                    "  hollywood - Toggle Hollywood hacking mode"
                ], 50);
            },
            ls: (args) => {
                const path = args[0] || state.cwd;
                const items = state.files[path] || [];
                if (items.length > 0) {
                    printLine(items.join('  '));
                } else if (state.files['/' + path]) {
                     printLine(state.files['/' + path].join('  '));
                } else {
                    printLine(`ls: cannot access '${path}': No such file or directory`);
                }
            },
            cat: (args) => {
                if (!args[0]) {
                    printLine("usage: cat <filename>");
                    return;
                }
                const content = state.fileContent[args[0]];
                if (content) {
                    printLine(content);
                } else {
                    printLine(`cat: ${args[0]}: No such file or directory`);
                }
            },
            whoami: () => {
                printLine(state.user);
            },
            clear: () => {
                output.innerHTML = '';
            },
            date: () => {
                printLine(new Date().toString());
            },
            ssh: async (args) => {
                if (!args[0]) {
                    printLine("usage: ssh <host>");
                    return;
                }
                await printLine(`Attempting to connect to ${args[0]}...`);
                await printLine("Connecting to port 22...", 'line', 800);
                await printLine("Handshaking...", 'line', 1000);
                await printLine("Authentication required.", 'line', 500);
                await printLine("Permission denied (publickey,password).", 'line', 200);
                accessDeniedSound();
            },
            scan: async (args) => {
                if (!args[0]) {
                    printLine("usage: scan <target_range>");
                    return;
                }
                await printLine(`Scanning targets in ${args[0]}...`);
                for (let i = 0; i <= 10; i++) {
                    await printLine(`[${'#'.repeat(i)}${'.'.repeat(10-i)}] ${i*10}%`, 'line', 200);
                }
                await printLine("Found 1 active host:");
                await printLine("192.168.1.104 - [OPEN PORTS: 22, 80, 443]");
            },
            crack: async (args) => {
                if (!args[0]) {
                    printLine("usage: crack <target>");
                    return;
                }
                await printLine(`Initializing brute force against ${args[0]}...`);
                let progress = 0;
                const interval = setInterval(() => {
                    const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*()";
                    let randomStr = "";
                    for(let i=0; i<10; i++) randomStr += chars.charAt(Math.floor(Math.random() * chars.length));
                    printLine(`CRACKING: ${randomStr} [${progress}%]`);
                    progress += 10;
                    if (progress > 100) {
                        clearInterval(interval);
                        printLine("PASSWORD FOUND: P4ssw0rd123", 'line', 500);
                        accessGrantedSound();
                    }
                }, 300);
            },
            exploit: async (args) => {
                if (!args[0]) {
                    printLine("usage: exploit <target>");
                    return;
                }
                await printLines([
                    `Loading exploit payloads for ${args[0]}...`,
                    "Checking buffer overflow vulnerability...",
                    "Payload injected.",
                    "Executing shellcode...",
                    "FAILED: No response from target. Firewall detected."
                ], 600);
                accessDeniedSound();
            },
            decrypt: async (args) => {
                if (!args[0]) {
                    printLine("usage: decrypt <file>");
                    return;
                }
                if (args[0] === 'mission_params.enc') {
                    await printLine("Decrypting mission_params.enc...");
                    await printLine("Searching for keys...", 'line', 1000);
                    await printLine("Key found in memory buffer.", 'line', 500);
                    await printLine("DECRYPTION COMPLETE:", 'line', 800);
                    await printLine("MISSION: HACK THE PLANET", 'line', 200);
                    accessGrantedSound();
                } else {
                    printLine(`decrypt: ${args[0]}: Cannot find decryption key.`);
                }
            },
            matrix: () => {
                state.isMatrixActive = !state.isMatrixActive;
                const canvas = document.getElementById('matrix-canvas');
                if (state.isMatrixActive) {
                    canvas.style.opacity = "0.3";
                    initMatrix();
                    printLine("Matrix effect enabled.");
                } else {
                    canvas.style.opacity = "0.1";
                    printLine("Matrix effect disabled.");
                }
            },
            hollywood: () => {
                state.isHollywoodMode = !state.isHollywoodMode;
                printLine(`Hollywood mode ${state.isHollywoodMode ? 'ENABLED' : 'DISABLED'}.`);
                printLine("In Hollywood mode, just smash your keyboard to hack.");
            }
        };

        function processCommand(inputStr) {
            const parts = inputStr.trim().split(/\s+/);
            const cmd = parts[0].toLowerCase();
            const args = parts.slice(1);

            if (cmd === '') return;

            if (commands[cmd]) {
                commands[cmd](args);
            } else {
                printLine(`${cmd}: command not found`);
            }
        }

        input.addEventListener('keydown', (e) => {
            if (state.isHollywoodMode && e.key !== 'Enter' && e.key !== 'Backspace') {
                e.preventDefault();
                const snippet = hollywoodSnippets[Math.floor(Math.random() * hollywoodSnippets.length)];
                printLine(snippet);
                input.value = "";
                return;
            }

            if (e.key === 'Enter') {
                const cmdStr = input.value;
                printLine(`${state.user}@${state.hostname}:${state.cwd}$ ${cmdStr}`);

                if (cmdStr.trim()) {
                    state.history.push(cmdStr);
                    state.historyIdx = state.history.length;
                }

                processCommand(cmdStr);
                input.value = '';
                updatePrompt();
            } else if (e.key === 'ArrowUp') {
                if (state.historyIdx > 0) {
                    state.historyIdx--;
                    input.value = state.history[state.historyIdx];
                }
                e.preventDefault();
            } else if (e.key === 'ArrowDown') {
                if (state.historyIdx < state.history.length - 1) {
                    state.historyIdx++;
                    input.value = state.history[state.historyIdx];
                } else {
                    state.historyIdx = state.history.length;
                    input.value = '';
                }
                e.preventDefault();
            }
        });

        // Matrix Effect
        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        let matrixInterval;

        function initMatrix() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            const columns = Math.floor(canvas.width / 20);
            const drops = new Array(columns).fill(1);

            if (matrixInterval) clearInterval(matrixInterval);
            matrixInterval = setInterval(() => {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#0F0';
                ctx.font = '15px monospace';

                for (let i = 0; i < drops.length; i++) {
                    const text = String.fromCharCode(Math.random() * 128);
                    ctx.fillText(text, i * 20, drops[i] * 20);
                    if (drops[i] * 20 > canvas.height && Math.random() > 0.975) drops[i] = 0;
                    drops[i]++;
                }
            }, 50);
        }
        initMatrix();

        document.addEventListener('click', () => {
            input.focus();
        });

        window.onload = async () => {
            await printLine("SYSTEM BOOTING...", 'line', 500);
            await printLine("ESTABLISHING SECURE CONNECTION...", 'line', 500);
            await printLine("WELCOME TO THE UNDERGROUND NODE.", 'line', 500);
            await printLine("TYPE 'help' FOR AVAILABLE COMMANDS.", 'line', 500);
            updatePrompt();
        };
    </script>
</body>
</html>
